# Project 8 - Pentesting Live Targets

Time spent: **X** hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:
* Username Enumeration
* Insecure Direct Object Reference (IDOR)
* SQL Injection (SQLi)
* Cross-Site Scripting (XSS)
* Cross-Site Request Forgery (CSRF)
* Session Hijacking/Fixation

Each version of the site has been given two of the six vulnerabilities. (In other words, all six of the exploits should be assignable to one of the sites.)

## Blue

- [X] Vulnerability #1: SQL Injection (SQLi)
- [X] Details along with Steps to recreate:
	- The Show Salespeople in the blue target website does not sanitize the id input before using it in a SQL query. This makes it vulnerable to SQL injection.
	- The GIF walkthrough below recreates this vulnerability by producing a blind SQL injection.
	- While viewing information about a saleperson if the id parameter is set to a valid id (8 or 2 for example), the page loads almost immediately.
	- SQL can be injected by setting the id paramter to a malicious SQL command/fragment. Provided below is the SQL fragment used in the GIF walkthrough below,  
	`' OR SLEEP(5)=0--'`
	- When the above sql command is injected, the database sleeps for 5 seconds while querying the data and hence we see the delay in loading the page.
	- The other two websites protect against this by sanitizing all input before using it in a SQL query.
- [X] GIF Walkthrough: ![](https://i.imgur.com/6EhtpNE.gif)

- [X] Vulnerability #2: Session Hijacking/Fixation
- [X] Details along with Steps to recreate:
	- The Blue target website is vulnerable to both session hijacking and session fixation attacks.
	- The GIF Walkthrough below demonstrates a session hijacking attack.
	- For the attack shown below, two different web browsers are used (Chrome browser is used as the target, and Firefox is used as the attacker)
	- Using the Chrome browser, log into the staff section and then using the provided PHP script copy the logged-in session ID of the target.
	- Next on the Firefox browser (attacker), use the provided PHP script to change it's session id to the copied session id.
	- After changing the session id in the Firefox browser, the attacker should have access to the staff area without actually loggin in.
	- As mentioned in the assignment notes, the other two websites protect against this by expiring its active sessions and requiring its users to re-login after every 30 minutes. 
- [X] GIF Walkthrough: ![](https://i.imgur.com/1wckyBs.gif)


## Green

- [X] Vulnerability #1: Username Enumeration
- [X] Details along with Steps to recreate:
	- A different login error message is displayed when the username is correct and password is wrong, versus when both username and password are wrong.
	- The existing username "jmonroe99" is used as a test in the walkthrough below
	- On the login page
		- When a correct username, "jmonroe99" for example, is used, the error message "Log in was unsuccessful." is displayed in bold.
		- When an incorrect username, "jmonroe9" for example, is used, the error message "Log in was unsuccessful." is not displayed in bold.
	- Thus, we can determine if the username is correct or not by determining if the error message is displayed in bold or not.
	- The other two websites protect against this by displaying the error message in bold during both the situations (when the username is correct and when the username is not correct).
- [X] GIF Walkthrough: ![](https://i.imgur.com/vab23Yn.gif)

- [X] Vulnerability #2: Cross-Site Scripting (XSS)
- [X] Details along with Steps to recreate:
	- The Contact Us page on the Green Target website has a mistake which leaves it vulnerable to a stored XSS attack.
	- On the Contact Us page, inject malicious JavaScript code in the Feedback section of the feedback form. Provided below is the javascript used in the GIF Walkthrough below  
	`<script>alert('Kevin Shah found the XSS!');</script>`
	- After submitting the feedback, whenever a logged in staff user visits the Feedback page under Staff Menu, the JavaScript is triggered when the page loads.
	- To prevent this, the other two websites must be sanitizing whatever gets be submitted using the feedback form.
- [X] GIF Walkthrough: ![](https://i.imgur.com/W04LUKS.gif)


## Red

- [X] Vulnerability #1: Insecure Direct Object Reference (IDOR)
- [X] Details along with Steps to recreate:
	- The Red target website is vulnerable to IDOR attack because it does not verify if the id parameter passed to the GET request corresponds to a saleperson whose information is not to be made public.
	- id = 10 and id = 11 correspond to salespersons whose information is not supposed to be public.
	- To recreate this vulnerability, visit the "Find a Salesperson page" on the Public Site, and click on any saleperson displayed.
	- By changing the id parameter in the URL to either 10 or 11, one can publicly view sensitive information.
	- The other two websites prevent this information leak by verifing if the id corresponds to a saleperson whose information is not supposed to be made public before serving to the GET request.
- [X] GIF Walkthrough: ![](https://i.imgur.com/pkUScIC.gif)

- [X] Vulnerability #2: Cross-Site Request Forgery (CSRF)
- [X] Details along with Steps to recreate:
	- The Red target website allows modification to its database content without a valid CSRF token.
	- Provided below is the html form (named CSRF_Attack.html) used to make changes to a Salesperson information in the database.  
	```
	<html>  
		<head>  
			<title>Fake Form</title>  
		</head>  
		<body onload="document.attack_form.submit()">  
			<form action="https://104.198.208.81/red/public/staff/salespeople/edit.php?id=5" method="POST" name="attack_form" style="display: none;" target="hidden_results" >  
				<input type="text" name="first_name" value="James" />  
				<input type="text" name="last_name" value="Barker" />  
				<input type="text" name="phone" value="555-352-9654" />  
				<input type="text" name="email" value="kbarker@salesperson.com" />  
			</form>  
			<iframe name="hidden_results" style="display: none;"></iframe>  
		</body>  
	</html>
	```
	- For the walkthrough below the above form is stored locally on the computer, but in a real word attack scenario, the form would probably be hosted on the web.
	- Attacker would then provide the location of the form as part of the feedback on the feedback form.
	- Next, a logged-in staff user reads the submitted malicious feedback.
	- When the staff user visits the provided location, the malicious form is submitted (without the knowledge of the staff user) as soon as the page loads
	- The above form changes the first name of the first saleperson from "Jim" to "James"
	- The above form could be modified to make similar changes to some other database content.
	- The other two websites protect against this by not allowing any modification to its database content without a valid CSRF token. 
- [X] GIF Walkthrough: ![](https://i.imgur.com/aT40Oo6.gif)

## Bonus Objective 2: Build on Objective #4 (Cross-Site Scripting).

- [X] a) Direct the user to a new URL
- [X] Details along with Steps to recreate:
	- It is very similar to the XSS vulnerability in the Green target website demonstrated above.
	- For directing the user to a new URL the following javascript is entered in the feedback section of the feedback form,  
	`<script>document.location= "http://www.google.com"</script>`
	- When the logged in staff user views the feedback, the javascript is triggered, and the user is directed to www.google.com
	- Note about GIF: The other javascript alerts that we see in the GIF Walkthrough below belong to other previous XSS attack attempts.
- [X] GIF Walkthrough for part a) : ![](https://i.imgur.com/YJz1R9f.gif)

- [X] b) Read cookie data, and c) Set cookie data
- [X] Details along with Steps to recreate:
	- Using XSS to read cookie data, and set cookie data is demonstrated together in the GIF walkthrough below
	- It is very similar to the XSS vulnerability in the Green target website demonstrated above.
	- For setting cookie data and reading cookie data, the following javascript is entered in the feedback section of the feedback form,  
	`<script>document.cookie = "newCookie=newCookieValue";alert(document.cookie)</script>`
	- The `document.cookie = "newCookie=newCookieValue"` fragment is used to set cookie data, and the `alert(document.cookie)` fragment is used to read cookie data.
	- When the logged in staff user views the feedback, the javascript is triggered. The javascript sets a new cookie with key = newCookie and value = newCookieValue, and next reads it using the javascript alert.	
	- Note about GIF: The other javascript alerts that we see in the GIF Walkthrough below belong to other previous XSS attack attempts.
- [X] GIF Walkthrough for part b) and c): ![](https://i.imgur.com/R7fSPtE.gif)

- In a real world attack, the attacker could use XSS to steal the target's cookies by combining the above 2 experiments together.

## Notes

Describe any challenges encountered while doing the work
